<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS - نظام التشغيل على الويب</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #0078d7;
            --primary-dark: #106ebe;
            --accent: #4CAF50;
            --dark: #1e1e1e;
            --light: #f3f3f3;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #2ecc71;
            --taskbar-h: 45px;
            --startmenu-w: 500px;
            --startmenu-h: 600px;
        }

        body {
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            height: 100vh;
            user-select: none;
        }

        /* شاشة الإعداد الأولي */
        .setup-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a3c6e 0%, #0d2b52 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
        }

        .setup-container {
            width: 90%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s;
        }

        .setup-step {
            display: none;
        }

        .setup-step.active {
            display: block;
        }

        .setup-title {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .setup-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 16px;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
        }

        .setup-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* شاشة تسجيل الدخول */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a3c6e 0%, #0d2b52 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9000;
            color: white;
        }

        .login-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s;
        }

        .user-profile {
            margin-bottom: 30px;
        }

        .user-profile img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 3px solid white;
        }

        .password-input {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .password-input input {
            padding: 12px;
            border: none;
            border-radius: 5px;
            width: 250px;
            font-size: 16px;
        }

        /* سطح المكتب */
        .desktop {
            display: none;
            width: 100%;
            height: 100vh;
            background: url('https://images.unsplash.com/photo-1505506874110-6a7a69069a08?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') center/cover no-repeat;
            position: relative;
        }

        /* شريط المهام */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--taskbar-h);
            background: rgba(30, 30, 30, 0.9);
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 999;
            backdrop-filter: blur(10px);
        }

        .start-menu-btn {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        .start-menu-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .taskbar-apps {
            flex: 1;
            display: flex;
            align-items: center;
            margin-left: 10px;
            gap: 5px;
        }

        .taskbar-app {
            padding: 8px 15px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .taskbar-app:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .taskbar-app.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .system-tray {
            display: flex;
            align-items: center;
            color: white;
            font-size: 14px;
            gap: 15px;
        }

        .system-icon {
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.3s;
        }

        .system-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* قائمة ابدأ */
        .start-menu {
            position: fixed;
            bottom: var(--taskbar-h);
            left: 0;
            width: var(--startmenu-w);
            height: var(--startmenu-h);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px 10px 0 0;
            display: none;
            grid-template-columns: 1fr 200px;
            z-index: 998;
            backdrop-filter: blur(10px);
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s;
        }

        .start-menu-left {
            padding: 20px;
            overflow-y: auto;
        }

        .pinned-apps, .all-apps {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #555;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.3s;
            text-align: center;
        }

        .app-item:hover {
            background: rgba(0, 120, 215, 0.1);
        }

        .app-item i {
            font-size: 32px;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .app-item span {
            font-size: 12px;
            color: #333;
        }

        .start-menu-right {
            background: rgba(0, 0, 0, 0.03);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .user-details h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .user-details p {
            font-size: 12px;
            color: #666;
        }

        .power-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .power-options button {
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .power-options button:hover {
            background: var(--primary-dark);
        }

        /* أيقونات سطح المكتب */
        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            cursor: pointer;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            padding: 10px 5px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .desktop-icon.selected {
            background: rgba(255, 255, 255, 0.2);
        }

        .desktop-icon i {
            font-size: 48px;
            margin-bottom: 8px;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.5));
        }

        .desktop-icon span {
            font-size: 13px;
        }

        /* النوافذ */
        .windows-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - var(--taskbar-h));
            pointer-events: none;
        }

        .window {
            position: absolute;
            min-width: 400px;
            min-height: 300px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            pointer-events: all;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: windowOpen 0.3s;
        }

        .window.maximized {
            width: 100% !important;
            height: calc(100% - var(--taskbar-h)) !important;
            top: 0 !important;
            left: 0 !important;
            border-radius: 0;
        }

        .window-header {
            height: 35px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            cursor: move;
            user-select: none;
        }

        .window-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .window-controls {
            display: flex;
        }

        .window-controls button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            width: 35px;
            height: 35px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .window-controls button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .window-content {
            flex: 1;
            overflow: auto;
            background: var(--light);
        }

        /* تطبيقات محددة */
        .file-explorer {
            display: flex;
            height: 100%;
        }

        .file-explorer .sidebar {
            width: 220px;
            background: #f8f8f8;
            padding: 15px;
            border-right: 1px solid #ddd;
            overflow-y: auto;
        }

        .file-explorer .sidebar h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #555;
        }

        .file-explorer .sidebar ul {
            list-style: none;
        }

        .file-explorer .sidebar li {
            padding: 8px 10px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .file-explorer .sidebar li:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .file-explorer .content-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }

        .file-explorer .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .file-explorer .toolbar button {
            padding: 6px 12px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }

        .file-explorer .toolbar button:hover {
            background: #f0f0f0;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .file-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
            transition: background 0.3s;
        }

        .file-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .file-item i {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .file-item span {
            font-size: 12px;
            word-break: break-word;
        }

        .notepad-content {
            width: 100%;
            height: 100%;
            border: none;
            resize: none;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            padding: 15px;
            line-height: 1.5;
        }

        .calculator {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-width: 300px;
            margin: 20px auto;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .calculator-display {
            grid-column: 1 / -1;
            height: 50px;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            text-align: right;
            font-size: 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            font-family: 'Consolas', monospace;
        }

        .calculator button {
            height: 50px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            font-size: 18px;
            border-radius: 5px;
            transition: background 0.2s;
        }

        .calculator button:hover {
            background: #f0f0f0;
        }

        .calculator .operator {
            background: #f0f0f0;
        }

        .calculator .equals {
            background: var(--primary);
            color: white;
        }

        .browser-content {
            width: 100%;
            height: calc(100% - 50px);
            border: none;
        }

        .browser-toolbar {
            display: flex;
            padding: 10px;
            background: #f3f3f3;
            border-bottom: 1px solid #ddd;
            gap: 10px;
            height: 50px;
        }

        .browser-toolbar input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 20px;
            font-size: 14px;
        }

        .browser-toolbar button {
            padding: 8px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }

        .browser-toolbar button:hover {
            background: var(--primary-dark);
        }

        .media-player {
            padding: 20px;
            text-align: center;
        }

        .media-player video {
            max-width: 100%;
            max-height: 400px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .media-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .media-controls button {
            padding: 10px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .media-controls button:hover {
            background: var(--primary-dark);
        }

        .settings-panel {
            padding: 20px;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .setting-item label {
            font-size: 14px;
        }

        .setting-item select, .setting-item input {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .user-manager {
            padding: 20px;
        }

        .user-list {
            margin-top: 20px;
        }

        .user-card {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
        }

        .user-card img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .user-info-full {
            flex: 1;
        }

        .user-info-full h4 {
            margin-bottom: 5px;
        }

        .user-info-full p {
            font-size: 14px;
            color: #666;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .user-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-edit {
            background: var(--primary);
            color: white;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        /* الرسوم المتحركة */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes windowOpen {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* التمرير المخصص */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- شاشة الإعداد الأولي -->
    <div id="setupScreen" class="setup-screen">
        <div class="setup-container">
            <div id="setupStep1" class="setup-step active">
                <h2 class="setup-title">مرحباً بك في WebOS</h2>
                <p style="text-align: center; margin-bottom: 20px;">سيقوم هذا الإعداد بإعداد نظام التشغيل WebOS على جهازك</p>
                <div class="setup-buttons">
                    <button class="btn btn-secondary" onclick="cancelSetup()">إلغاء</button>
                    <button class="btn" onclick="nextSetupStep()">التالي</button>
                </div>
            </div>
            
            <div id="setupStep2" class="setup-step">
                <h2 class="setup-title">إنشاء المستخدم الرئيسي</h2>
                <div class="setup-form">
                    <div class="form-group">
                        <label for="adminUsername">اسم المستخدم:</label>
                        <input type="text" id="adminUsername" placeholder="أدخل اسم المستخدم">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">كلمة المرور:</label>
                        <input type="password" id="adminPassword" placeholder="أدخل كلمة المرور">
                    </div>
                    <div class="form-group">
                        <label for="adminEmail">البريد الإلكتروني:</label>
                        <input type="email" id="adminEmail" placeholder="أدخل بريدك الإلكتروني">
                    </div>
                </div>
                <div class="setup-buttons">
                    <button class="btn btn-secondary" onclick="prevSetupStep()">السابق</button>
                    <button class="btn" onclick="nextSetupStep()">التالي</button>
                </div>
            </div>
            
            <div id="setupStep3" class="setup-step">
                <h2 class="setup-title">إعدادات النظام</h2>
                <div class="setup-form">
                    <div class="form-group">
                        <label for="systemLanguage">لغة النظام:</label>
                        <select id="systemLanguage">
                            <option value="ar">العربية</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="systemTheme">سمة النظام:</label>
                        <select id="systemTheme">
                            <option value="light">فاتح</option>
                            <option value="dark">داكن</option>
                            <option value="auto">تلقائي</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="wallpaper">خلفية سطح المكتب:</label>
                        <select id="wallpaper">
                            <option value="default">الافتراضية</option>
                            <option value="nature">الطبيعة</option>
                            <option value="abstract">مجردة</option>
                        </select>
                    </div>
                </div>
                <div class="setup-buttons">
                    <button class="btn btn-secondary" onclick="prevSetupStep()">السابق</button>
                    <button class="btn" onclick="completeSetup()">إنهاء الإعداد</button>
                </div>
            </div>
        </div>
    </div>

    <!-- شاشة تسجيل الدخول -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="user-profile">
                <img id="loginUserImage" src="https://i.pravatar.cc/150?img=12" alt="User">
                <h2 id="loginUsername">مستخدم</h2>
            </div>
            <div class="password-input">
                <input type="password" placeholder="أدخل كلمة المرور" id="passwordInput">
                <button class="btn" id="loginBtn">تسجيل الدخول <i class="fas fa-arrow-right"></i></button>
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="showUserManager()">إدارة المستخدمين</button>
            </div>
        </div>
    </div>

    <!-- سطح المكتب -->
    <div id="desktop" class="desktop">
        <!-- شريط المهام -->
        <div class="taskbar">
            <div class="start-menu-btn" id="startMenuBtn">
                <i class="fab fa-windows fa-lg" style="color: white;"></i>
            </div>
            <div class="taskbar-apps" id="taskbarApps"></div>
            <div class="system-tray">
                <div class="system-icon">
                    <i class="fas fa-wifi"></i>
                </div>
                <div class="system-icon">
                    <i class="fas fa-volume-up"></i>
                </div>
                <div class="system-icon" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                </div>
                <div id="clock">12:00 PM</div>
                <div id="date">Jan 1, 2023</div>
                <div class="system-icon" id="userMenuBtn">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>

        <!-- قائمة ابدأ -->
        <div id="startMenu" class="start-menu">
            <div class="start-menu-left">
                <div class="pinned-apps">
                    <div class="section-title">التطبيقات المثبتة</div>
                    <div class="app-grid">
                        <div class="app-item" data-app="fileExplorer">
                            <i class="fas fa-folder"></i>
                            <span>مستكشف الملفات</span>
                        </div>
                        <div class="app-item" data-app="notepad">
                            <i class="fas fa-file-alt"></i>
                            <span>المفكرة</span>
                        </div>
                        <div class="app-item" data-app="calculator">
                            <i class="fas fa-calculator"></i>
                            <span>الآلة الحاسبة</span>
                        </div>
                        <div class="app-item" data-app="browser">
                            <i class="fas fa-globe"></i>
                            <span>متصفح الويب</span>
                        </div>
                        <div class="app-item" data-app="mediaPlayer">
                            <i class="fas fa-play-circle"></i>
                            <span>مشغل الوسائط</span>
                        </div>
                        <div class="app-item" data-app="settings">
                            <i class="fas fa-cog"></i>
                            <span>الإعدادات</span>
                        </div>
                    </div>
                </div>
                <div class="all-apps">
                    <div class="section-title">جميع التطبيقات</div>
                    <div class="app-grid">
                        <div class="app-item" data-app="userManager">
                            <i class="fas fa-users"></i>
                            <span>إدارة المستخدمين</span>
                        </div>
                        <div class="app-item" data-app="terminal">
                            <i class="fas fa-terminal"></i>
                            <span>الطرفية</span>
                        </div>
                        <div class="app-item" data-app="calendar">
                            <i class="fas fa-calendar-alt"></i>
                            <span>التقويم</span>
                        </div>
                        <div class="app-item" data-app="camera">
                            <i class="fas fa-camera"></i>
                            <span>الكاميرا</span>
                        </div>
                        <div class="app-item" data-app="mail">
                            <i class="fas fa-envelope"></i>
                            <span>البريد</span>
                        </div>
                        <div class="app-item" data-app="store">
                            <i class="fas fa-shopping-bag"></i>
                            <span>المتجر</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="start-menu-right">
                <div class="user-info">
                    <img id="currentUserImage" src="https://i.pravatar.cc/150?img=12" alt="User">
                    <div class="user-details">
                        <h3 id="currentUsername">مستخدم</h3>
                        <p id="currentUserRole">مسؤول</p>
                    </div>
                </div>
                <div class="power-options">
                    <button id="lockBtn"><i class="fas fa-lock"></i> قفل الشاشة</button>
                    <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
                    <button id="shutdownBtn"><i class="fas fa-power-off"></i> إيقاف التشغيل</button>
                </div>
            </div>
        </div>

        <!-- النوافذ المفتوحة -->
        <div id="windowsContainer" class="windows-container"></div>

        <!-- أيقونات سطح المكتب -->
        <div class="desktop-icons">
            <div class="desktop-icon" data-app="fileExplorer">
                <i class="fas fa-folder"></i>
                <span>المستندات</span>
            </div>
            <div class="desktop-icon" data-app="notepad">
                <i class="fas fa-file-alt"></i>
                <span>المفكرة</span>
            </div>
            <div class="desktop-icon" data-app="browser">
                <i class="fas fa-globe"></i>
                <span>المتصفح</span>
            </div>
            <div class="desktop-icon" data-app="recycleBin">
                <i class="fas fa-trash-alt"></i>
                <span>سلة المحذوفات</span>
            </div>
        </div>
    </div>

    <script>
        // قاعدة بيانات افتراضية
        const WebOSDB = {
            users: [],
            files: [],
            settings: {},
            sessions: [],
            
            init: function() {
                // تحقق إذا كان هناك بيانات محفوظة مسبقاً
                const savedData = localStorage.getItem('webos_data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    this.users = data.users || [];
                    this.files = data.files || [];
                    this.settings = data.settings || {};
                    this.sessions = data.sessions || [];
                } else {
                    // بيانات افتراضية
                    this.settings = {
                        language: 'ar',
                        theme: 'light',
                        wallpaper: 'default'
                    };
                    this.save();
                }
            },
            
            save: function() {
                const data = {
                    users: this.users,
                    files: this.files,
                    settings: this.settings,
                    sessions: this.sessions
                };
                localStorage.setItem('webos_data', JSON.stringify(data));
            },
            
            addUser: function(user) {
                user.id = this.users.length + 1;
                user.createdAt = new Date().toISOString();
                this.users.push(user);
                this.save();
                return user.id;
            },
            
            getUser: function(username) {
                return this.users.find(u => u.username === username);
            },
            
            updateUser: function(id, updates) {
                const userIndex = this.users.findIndex(u => u.id === id);
                if (userIndex !== -1) {
                    this.users[userIndex] = {...this.users[userIndex], ...updates};
                    this.save();
                    return true;
                }
                return false;
            },
            
            deleteUser: function(id) {
                const userIndex = this.users.findIndex(u => u.id === id);
                if (userIndex !== -1) {
                    this.users.splice(userIndex, 1);
                    this.save();
                    return true;
                }
                return false;
            },
            
            addFile: function(file) {
                file.id = this.files.length + 1;
                file.createdAt = new Date().toISOString();
                file.modifiedAt = new Date().toISOString();
                this.files.push(file);
                this.save();
                return file.id;
            },
            
            getFiles: function(userId) {
                return this.files.filter(f => f.userId === userId);
            },
            
            updateFile: function(id, updates) {
                const fileIndex = this.files.findIndex(f => f.id === id);
                if (fileIndex !== -1) {
                    this.files[fileIndex] = {...this.files[fileIndex], ...updates, modifiedAt: new Date().toISOString()};
                    this.save();
                    return true;
                }
                return false;
            },
            
            deleteFile: function(id) {
                const fileIndex = this.files.findIndex(f => f.id === id);
                if (fileIndex !== -1) {
                    this.files.splice(fileIndex, 1);
                    this.save();
                    return true;
                }
                return false;
            },
            
            updateSettings: function(newSettings) {
                this.settings = {...this.settings, ...newSettings};
                this.save();
            }
        };

        // نظام التشغيل
        const WebOS = {
            currentUser: null,
            windows: [],
            zIndexCounter: 1000,
            activeWindow: null,
            calculatorValue: '0',
            
            init: function() {
                WebOSDB.init();
                
                // التحقق إذا كان النظام مهيأ
                if (WebOSDB.users.length === 0) {
                    this.showSetupScreen();
                } else {
                    this.showLoginScreen();
                }
                
                // إعداد المستمعين للأحداث
                this.setupEventListeners();
                
                // تحديث الوقت والتاريخ
                this.updateDateTime();
                setInterval(() => this.updateDateTime(), 1000);
            },
            
            showSetupScreen: function() {
                document.getElementById('setupScreen').style.display = 'flex';
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('desktop').style.display = 'none';
            },
            
            showLoginScreen: function() {
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('desktop').style.display = 'none';
                
                // عرض أول مستخدم كافتراضي
                if (WebOSDB.users.length > 0) {
                    const user = WebOSDB.users[0];
                    document.getElementById('loginUsername').textContent = user.username;
                    document.getElementById('loginUserImage').src = user.avatar || 'https://i.pravatar.cc/150?img=12';
                }
            },
            
            showDesktop: function() {
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('desktop').style.display = 'block';
                
                // تحديث معلومات المستخدم الحالي
                if (this.currentUser) {
                    document.getElementById('currentUsername').textContent = this.currentUser.username;
                    document.getElementById('currentUserRole').textContent = this.currentUser.role === 'admin' ? 'مسؤول' : 'مستخدم';
                    document.getElementById('currentUserImage').src = this.currentUser.avatar || 'https://i.pravatar.cc/150?img=12';
                }
            },
            
            setupEventListeners: function() {
                // تسجيل الدخول
                document.getElementById('loginBtn').addEventListener('click', () => this.login());
                document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.login();
                });
                
                // قائمة ابدأ
                document.getElementById('startMenuBtn').addEventListener('click', () => {
                    const startMenu = document.getElementById('startMenu');
                    startMenu.style.display = startMenu.style.display === 'grid' ? 'none' : 'grid';
                });
                
                // إغلاق قائمة ابدأ عند النقر خارجها
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#startMenu') && !e.target.closest('#startMenuBtn')) {
                        document.getElementById('startMenu').style.display = 'none';
                    }
                });
                
                // فتح التطبيقات من قائمة ابدأ
                document.querySelectorAll('.app-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const appName = item.getAttribute('data-app');
                        this.openApp(appName);
                        document.getElementById('startMenu').style.display = 'none';
                    });
                });
                
                // فتح التطبيقات من أيقونات سطح المكتب
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    icon.addEventListener('dblclick', () => {
                        const appName = icon.getAttribute('data-app');
                        this.openApp(appName);
                    });
                });
                
                // إدارة الطاقة
                document.getElementById('lockBtn').addEventListener('click', () => this.lockScreen());
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                document.getElementById('shutdownBtn').addEventListener('click', () => this.shutdown());
            },
            
            login: function() {
                const username = document.getElementById('loginUsername').textContent;
                const password = document.getElementById('passwordInput').value;
                
                const user = WebOSDB.getUser(username);
                if (user && user.password === password) {
                    this.currentUser = user;
                    this.showDesktop();
                    document.getElementById('passwordInput').value = '';
                    
                    // تسجيل جلسة المستخدم
                    WebOSDB.sessions.push({
                        userId: user.id,
                        loginTime: new Date().toISOString(),
                        logoutTime: null
                    });
                    WebOSDB.save();
                } else {
                    alert('كلمة المرور غير صحيحة!');
                }
            },
            
            logout: function() {
                // تحديث وقت تسجيل الخروج
                if (this.currentUser) {
                    const session = WebOSDB.sessions.find(s => s.userId === this.currentUser.id && !s.logoutTime);
                    if (session) {
                        session.logoutTime = new Date().toISOString();
                        WebOSDB.save();
                    }
                }
                
                this.currentUser = null;
                this.windows = [];
                document.getElementById('windowsContainer').innerHTML = '';
                document.getElementById('taskbarApps').innerHTML = '';
                this.showLoginScreen();
            },
            
            lockScreen: function() {
                this.showLoginScreen();
            },
            
            shutdown: function() {
                if (confirm('هل تريد إيقاف تشغيل النظام؟')) {
                    this.logout();
                }
            },
            
            updateDateTime: function() {
                const now = new Date();
                document.getElementById('clock').textContent = now.toLocaleTimeString('ar-EG');
                document.getElementById('date').textContent = now.toLocaleDateString('ar-EG');
            },
            
            openApp: function(appName) {
                const windowId = 'window_' + Date.now();
                const windowElement = document.createElement('div');
                windowElement.className = 'window';
                windowElement.id = windowId;
                windowElement.style.zIndex = this.zIndexCounter++;
                windowElement.style.left = '100px';
                windowElement.style.top = '100px';
                
                let windowTitle = '';
                let windowContent = '';
                
                switch(appName) {
                    case 'fileExplorer':
                        windowTitle = 'مستكشف الملفات';
                        windowContent = this.getFileExplorerContent();
                        break;
                    case 'notepad':
                        windowTitle = 'المفكرة';
                        windowContent = this.getNotepadContent();
                        break;
                    case 'calculator':
                        windowTitle = 'الآلة الحاسبة';
                        windowContent = this.getCalculatorContent();
                        break;
                    case 'browser':
                        windowTitle = 'متصفح الويب';
                        windowContent = this.getBrowserContent();
                        break;
                    case 'mediaPlayer':
                        windowTitle = 'مشغل الوسائط';
                        windowContent = this.getMediaPlayerContent();
                        break;
                    case 'settings':
                        windowTitle = 'الإعدادات';
                        windowContent = this.getSettingsContent();
                        break;
                    case 'userManager':
                        windowTitle = 'إدارة المستخدمين';
                        windowContent = this.getUserManagerContent();
                        break;
                    default:
                        windowTitle = appName;
                        windowContent = `<div style="padding: 20px; text-align: center;"><h2>${appName}</h2><p>هذا التطبيق قيد التطوير</p></div>`;
                }
                
                windowElement.innerHTML = `
                    <div class="window-header">
                        <div class="window-title">
                            <i class="fas fa-folder" style="color: white;"></i>
                            <span>${windowTitle}</span>
                        </div>
                        <div class="window-controls">
                            <button class="minimize-btn">−</button>
                            <button class="maximize-btn">□</button>
                            <button class="close-btn">×</button>
                        </div>
                    </div>
                    <div class="window-content">
                        ${windowContent}
                    </div>
                `;
                
                document.getElementById('windowsContainer').appendChild(windowElement);
                
                this.windows.push({
                    id: windowId,
                    element: windowElement,
                    app: appName,
                    title: windowTitle
                });
                
                this.makeWindowActive(windowId);
                this.addToTaskbar(windowId, windowTitle, appName);
                this.setupWindowControls(windowElement, windowId);
            },
            
            getFileExplorerContent: function() {
                const userFiles = WebOSDB.getFiles(this.currentUser.id);
                
                let filesHTML = '';
                userFiles.forEach(file => {
                    let icon = 'fa-file';
                    if (file.type === 'folder') icon = 'fa-folder';
                    else if (file.type === 'image') icon = 'fa-file-image';
                    else if (file.type === 'document') icon = 'fa-file-alt';
                    else if (file.type === 'video') icon = 'fa-file-video';
                    
                    filesHTML += `
                        <div class="file-item" data-file="${file.id}">
                            <i class="fas ${icon}" style="color: ${file.type === 'folder' ? '#0078d7' : '#666'};"></i>
                            <span>${file.name}</span>
                        </div>
                    `;
                });
                
                return `
                    <div class="file-explorer">
                        <div class="sidebar">
                            <h3>الوصول السريع</h3>
                            <ul>
                                <li><i class="fas fa-desktop"></i> سطح المكتب</li>
                                <li><i class="fas fa-download"></i> التنزيلات</li>
                                <li><i class="fas fa-file"></i> المستندات</li>
                                <li><i class="fas fa-image"></i> الصور</li>
                                <li><i class="fas fa-music"></i> الموسيقى</li>
                                <li><i class="fas fa-film"></i> الفيديوهات</li>
                            </ul>
                            <h3>هذا الكمبيوتر</h3>
                            <ul>
                                <li><i class="fas fa-hdd"></i> القرص المحلي (C:)</li>
                                <li><i class="fas fa-hdd"></i> القرص المحلي (D:)</li>
                                <li><i class="fas fa-compact-disc"></i> محرك الأقراص (E:)</li>
                            </ul>
                        </div>
                        <div class="content-area">
                            <div class="toolbar">
                                <button><i class="fas fa-arrow-left"></i> رجوع</button>
                                <button><i class="fas fa-arrow-right"></i> تقدم</button>
                                <button><i class="fas fa-arrow-up"></i> أعلى</button>
                                <button><i class="fas fa-sync-alt"></i> تحديث</button>
                                <button><i class="fas fa-plus"></i> جديد</button>
                            </div>
                            <div class="files-grid">
                                ${filesHTML}
                            </div>
                        </div>
                    </div>
                `;
            },
            
            getNotepadContent: function() {
                return `
                    <textarea class="notepad-content" placeholder="ابدأ الكتابة...">مرحباً بك في WebOS!
يمكنك استخدام هذا التطبيق لكتابة وتحرير الملفات النصية.

الميزات:
- تحرير النصوص البسيط
- وظيفة الحفظ التلقائي
- التنسيق الأساسي

جربها الآن!</textarea>
                `;
            },
            
            getCalculatorContent: function() {
                return `
                    <div class="calculator">
                        <div class="calculator-display" id="calcDisplay">0</div>
                        <button onclick="WebOS.calculatorAction('C')">C</button>
                        <button onclick="WebOS.calculatorAction('±')">±</button>
                        <button onclick="WebOS.calculatorAction('%')">%</button>
                        <button onclick="WebOS.calculatorAction('/')" class="operator">/</button>
                        <button onclick="WebOS.calculatorAction('7')">7</button>
                        <button onclick="WebOS.calculatorAction('8')">8</button>
                        <button onclick="WebOS.calculatorAction('9')">9</button>
                        <button onclick="WebOS.calculatorAction('*')" class="operator">×</button>
                        <button onclick="WebOS.calculatorAction('4')">4</button>
                        <button onclick="WebOS.calculatorAction('5')">5</button>
                        <button onclick="WebOS.calculatorAction('6')">6</button>
                        <button onclick="WebOS.calculatorAction('-')" class="operator">-</button>
                        <button onclick="WebOS.calculatorAction('1')">1</button>
                        <button onclick="WebOS.calculatorAction('2')">2</button>
                        <button onclick="WebOS.calculatorAction('3')">3</button>
                        <button onclick="WebOS.calculatorAction('+')" class="operator">+</button>
                        <button onclick="WebOS.calculatorAction('0')" style="grid-column: span 2;">0</button>
                        <button onclick="WebOS.calculatorAction('.')">.</button>
                        <button onclick="WebOS.calculatorAction('=')" class="equals">=</button>
                    </div>
                `;
            },
            
            getBrowserContent: function() {
                return `
                    <div class="browser-toolbar">
                        <button><i class="fas fa-arrow-left"></i></button>
                        <button><i class="fas fa-arrow-right"></i></button>
                        <button><i class="fas fa-redo"></i></button>
                        <input type="text" placeholder="ابحث أو أدخل اسم الموقع" value="https://www.example.com">
                        <button><i class="fas fa-search"></i></button>
                    </div>
                    <iframe class="browser-content" src="https://www.example.com"></iframe>
                `;
            },
            
            getMediaPlayerContent: function() {
                return `
                    <div class="media-player">
                        <video controls>
                            <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                            متصفحك لا يديع تشغيل الفيديو
                        </video>
                        <div class="media-controls">
                            <button><i class="fas fa-play"></i> تشغيل</button>
                            <button><i class="fas fa-pause"></i> إيقاف</button>
                            <button><i class="fas fa-stop"></i> وقف</button>
                            <button><i class="fas fa-volume-up"></i> الصوت</button>
                        </div>
                    </div>
                `;
            },
            
            getSettingsContent: function() {
                return `
                    <div class="settings-panel">
                        <div class="settings-section">
                            <h3>النظام</h3>
                            <div class="setting-item">
                                <label for="themeSelect">السمة:</label>
                                <select id="themeSelect">
                                    <option value="light">فاتح</option>
                                    <option value="dark">داكن</option>
                                    <option value="auto">تلقائي</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="wallpaperSelect">خلفية سطح المكتب:</label>
                                <select id="wallpaperSelect">
                                    <option value="default">الافتراضية</option>
                                    <option value="nature">الطبيعة</option>
                                    <option value="abstract">مجردة</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>العرض</h3>
                            <div class="setting-item">
                                <label for="resolutionSelect">الدقة:</label>
                                <select id="resolutionSelect">
                                    <option value="1080p">1920x1080</option>
                                    <option value="720p">1280x720</option>
                                    <option value="480p">854x480</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="brightnessRange">السطوع:</label>
                                <input type="range" id="brightnessRange" min="0" max="100" value="80">
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>الصوت</h3>
                            <div class="setting-item">
                                <label for="volumeRange">مستوى الصوت:</label>
                                <input type="range" id="volumeRange" min="0" max="100" value="70">
                            </div>
                            <div class="setting-item">
                                <label for="soundScheme">نظام الصوت:</label>
                                <select id="soundScheme">
                                    <option value="default">الافتراضي</option>
                                    <option value="classic">كلاسيكي</option>
                                    <option value="nature">أصوات الطبيعة</option>
                                </select>
                            </div>
                        </div>
                    </div>
                `;
            },
            
            getUserManagerContent: function() {
                let usersHTML = '';
                WebOSDB.users.forEach(user => {
                    usersHTML += `
                        <div class="user-card">
                            <img src="${user.avatar || 'https://i.pravatar.cc/150?img=12'}" alt="${user.username}">
                            <div class="user-info-full">
                                <h4>${user.username}</h4>
                                <p>${user.email} - ${user.role === 'admin' ? 'مسؤول' : 'مستخدم'}</p>
                                <p>تم الإنشاء: ${new Date(user.createdAt).toLocaleDateString('ar-EG')}</p>
                            </div>
                            <div class="user-actions">
                                <button class="btn-edit" onclick="WebOS.editUser(${user.id})">تعديل</button>
                                ${user.id !== this.currentUser.id ? `<button class="btn-delete" onclick="WebOS.deleteUser(${user.id})">حذف</button>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                return `
                    <div class="user-manager">
                        <h3>إدارة المستخدمين</h3>
                        <button class="btn" onclick="WebOS.showAddUserForm()"><i class="fas fa-plus"></i> إضافة مستخدم</button>
                        <div class="user-list">
                            ${usersHTML}
                        </div>
                    </div>
                `;
            },
            
            showAddUserForm: function() {
                const username = prompt('أدخل اسم المستخدم:');
                if (!username) return;
                
                const password = prompt('أدخل كلمة المرور:');
                if (!password) return;
                
                const email = prompt('أدخل البريد الإلكتروني:');
                if (!email) return;
                
                const role = confirm('هل تريد جعل هذا المستخدم مسؤولاً؟') ? 'admin' : 'user';
                
                WebOSDB.addUser({
                    username,
                    password,
                    email,
                    role,
                    avatar: `https://i.pravatar.cc/150?img=${WebOSDB.users.length + 10}`
                });
                
                alert('تم إضافة المستخدم بنجاح!');
                
                // إعادة فتح نافذة إدارة المستخدمين لتحديث القائمة
                const userManagerWindow = this.windows.find(w => w.app === 'userManager');
                if (userManagerWindow) {
                    this.closeWindow(userManagerWindow.id);
                    this.openApp('userManager');
                }
            },
            
            editUser: function(userId) {
                const user = WebOSDB.users.find(u => u.id === userId);
                if (!user) return;
                
                const newUsername = prompt('اسم المستخدم الجديد:', user.username);
                if (!newUsername) return;
                
                const newEmail = prompt('البريد الإلكتروني الجديد:', user.email);
                if (!newEmail) return;
                
                const newRole = confirm('هل تريد جعل هذا المستخدم مسؤولاً؟') ? 'admin' : 'user';
                
                WebOSDB.updateUser(userId, {
                    username: newUsername,
                    email: newEmail,
                    role: newRole
                });
                
                alert('تم تحديث المستخدم بنجاح!');
                
                // إعادة فتح نافذة إدارة المستخدمين لتحديث القائمة
                const userManagerWindow = this.windows.find(w => w.app === 'userManager');
                if (userManagerWindow) {
                    this.closeWindow(userManagerWindow.id);
                    this.openApp('userManager');
                }
            },
            
            deleteUser: function(userId) {
                if (confirm('هل أنت متأكد من حذف هذا المستخدم؟')) {
                    WebOSDB.deleteUser(userId);
                    alert('تم حذف المستخدم بنجاح!');
                    
                    // إعادة فتح نافذة إدارة المستخدمين لتحديث القائمة
                    const userManagerWindow = this.windows.find(w => w.app === 'userManager');
                    if (userManagerWindow) {
                        this.closeWindow(userManagerWindow.id);
                        this.openApp('userManager');
                    }
                }
            },
            
            calculatorAction: function(action) {
                if (action === 'C') {
                    this.calculatorValue = '0';
                } else if (action === '=') {
                    try {
                        let expression = this.calculatorValue.replace(/×/g, '*').replace(/÷/g, '/');
                        this.calculatorValue = eval(expression).toString();
                    } catch (e) {
                        this.calculatorValue = 'Error';
                    }
                } else {
                    if (this.calculatorValue === '0' || this.calculatorValue === 'Error') {
                        this.calculatorValue = action;
                    } else {
                        this.calculatorValue += action;
                    }
                }
                
                const display = document.getElementById('calcDisplay');
                if (display) {
                    display.textContent = this.calculatorValue;
                }
            },
            
            setupWindowControls: function(windowElement, windowId) {
                const header = windowElement.querySelector('.window-header');
                const minimizeBtn = windowElement.querySelector('.minimize-btn');
                const maximizeBtn = windowElement.querySelector('.maximize-btn');
                const closeBtn = windowElement.querySelector('.close-btn');
                
                windowElement.addEventListener('mousedown', () => {
                    this.makeWindowActive(windowId);
                });
                
                minimizeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    windowElement.style.display = 'none';
                    const taskbarApp = document.querySelector(`.taskbar-app[data-window="${windowId}"]`);
                    if (taskbarApp) {
                        taskbarApp.classList.remove('active');
                    }
                });
                
                maximizeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (windowElement.classList.contains('maximized')) {
                        windowElement.classList.remove('maximized');
                        windowElement.style.width = '';
                        windowElement.style.height = '';
                        windowElement.style.top = '';
                        windowElement.style.left = '';
                    } else {
                        windowElement.classList.add('maximized');
                        windowElement.style.width = '100%';
                        windowElement.style.height = 'calc(100% - var(--taskbar-h))';
                        windowElement.style.top = '0';
                        windowElement.style.left = '0';
                    }
                });
                
                closeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.closeWindow(windowId);
                });
                
                let isDragging = false;
                let dragOffset = { x: 0, y: 0 };
                
                header.addEventListener('mousedown', (e) => {
                    if (windowElement.classList.contains('maximized')) return;
                    
                    isDragging = true;
                    dragOffset.x = e.clientX - windowElement.offsetLeft;
                    dragOffset.y = e.clientY - windowElement.offsetTop;
                    
                    this.makeWindowActive(windowId);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        windowElement.style.left = (e.clientX - dragOffset.x) + 'px';
                        windowElement.style.top = (e.clientY - dragOffset.y) + 'px';
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            },
            
            makeWindowActive: function(windowId) {
                const window = this.windows.find(w => w.id === windowId);
                if (window) {
                    this.windows.forEach(w => {
                        w.element.style.zIndex = 1000;
                    });
                    
                    window.element.style.zIndex = this.zIndexCounter++;
                    this.activeWindow = window;
                    
                    document.querySelectorAll('.taskbar-app').forEach(app => {
                        app.classList.remove('active');
                    });
                    
                    const taskbarApp = document.querySelector(`.taskbar-app[data-window="${windowId}"]`);
                    if (taskbarApp) {
                        taskbarApp.classList.add('active');
                    }
                }
            },
            
            addToTaskbar: function(windowId, title, appName) {
                const taskbarApps = document.getElementById('taskbarApps');
                const taskbarApp = document.createElement('div');
                taskbarApp.className = 'taskbar-app active';
                taskbarApp.innerHTML = `<i class="fas fa-${this.getAppIcon(appName)}"></i> ${title}`;
                taskbarApp.setAttribute('data-window', windowId);
                
                taskbarApp.addEventListener('click', () => {
                    const targetWindow = document.getElementById(windowId);
                    if (targetWindow.style.display === 'none') {
                        targetWindow.style.display = 'flex';
                        this.makeWindowActive(windowId);
                    } else {
                        if (this.activeWindow && this.activeWindow.id === windowId) {
                            targetWindow.style.display = 'none';
                            taskbarApp.classList.remove('active');
                        } else {
                            this.makeWindowActive(windowId);
                        }
                    }
                });
                
                taskbarApps.appendChild(taskbarApp);
            },
            
            getAppIcon: function(appName) {
                const icons = {
                    'fileExplorer': 'folder',
                    'notepad': 'file-alt',
                    'calculator': 'calculator',
                    'browser': 'globe',
                    'mediaPlayer': 'play-circle',
                    'settings': 'cog',
                    'userManager': 'users',
                    'terminal': 'terminal',
                    'calendar': 'calendar-alt',
                    'camera': 'camera',
                    'mail': 'envelope',
                    'store': 'shopping-bag',
                    'recycleBin': 'trash-alt'
                };
                
                return icons[appName] || 'window-maximize';
            },
            
            closeWindow: function(windowId) {
                const windowIndex = this.windows.findIndex(w => w.id === windowId);
                if (windowIndex !== -1) {
                    const windowElement = document.getElementById(windowId);
                    if (windowElement) {
                        windowElement.remove();
                    }
                    
                    const taskbarApp = document.querySelector(`.taskbar-app[data-window="${windowId}"]`);
                    if (taskbarApp) {
                        taskbarApp.remove();
                    }
                    
                    this.windows.splice(windowIndex, 1);
                    
                    if (this.activeWindow && this.activeWindow.id === windowId) {
                        this.activeWindow = this.windows.length > 0 ? this.windows[this.windows.length - 1] : null;
                    }
                }
            }
        };

        // وظائف الإعداد
        let currentSetupStep = 1;
        
        function nextSetupStep() {
            document.getElementById(`setupStep${currentSetupStep}`).classList.remove('active');
            currentSetupStep++;
            document.getElementById(`setupStep${currentSetupStep}`).classList.add('active');
        }
        
        function prevSetupStep() {
            document.getElementById(`setupStep${currentSetupStep}`).classList.remove('active');
            currentSetupStep--;
            document.getElementById(`setupStep${currentSetupStep}`).classList.add('active');
        }
        
        function cancelSetup() {
            if (confirm('هل تريد إلغاء الإعداد؟ سيتم إغلاق النظام.')) {
                window.close();
            }
        }
        
        function completeSetup() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const email = document.getElementById('adminEmail').value;
            
            if (!username || !password || !email) {
                alert('يرجى ملء جميع الحقول!');
                return;
            }
            
            // إضافة المستخدم الرئيسي
            WebOSDB.addUser({
                username,
                password,
                email,
                role: 'admin',
                avatar: 'https://i.pravatar.cc/150?img=12'
            });
            
            // حفظ إعدادات النظام
            const language = document.getElementById('systemLanguage').value;
            const theme = document.getElementById('systemTheme').value;
            const wallpaper = document.getElementById('wallpaper').value;
            
            WebOSDB.updateSettings({
                language,
                theme,
                wallpaper
            });
            
            // إضافة بعض الملفات الافتراضية
            WebOSDB.addFile({
                userId: 1,
                name: 'مستنداتي',
                type: 'folder',
                size: '0 KB',
                path: '/Users/Admin/مستنداتي'
            });
            
            WebOSDB.addFile({
                userId: 1,
                name: 'ملاحظات.txt',
                type: 'document',
                size: '1.2 KB',
                path: '/Users/Admin/ملاحظات.txt',
                content: 'مرحباً بك في WebOS!'
            });
            
            alert('تم إعداد النظام بنجاح! يمكنك الآن تسجيل الدخول.');
            WebOS.showLoginScreen();
        }
        
        function showUserManager() {
            if (WebOSDB.users.length === 0) {
                alert('لا يوجد مستخدمين! يرجى إكمال إعداد النظام أولاً.');
                return;
            }
            
            // إذا كان هناك مستخدمين، عرض قائمة المستخدمين
            let usersList = 'اختر مستخدم للدخول:\n\n';
            WebOSDB.users.forEach((user, index) => {
                usersList += `${index + 1}. ${user.username} (${user.role === 'admin' ? 'مسؤول' : 'مستخدم'})\n`;
            });
            
            const userChoice = prompt(usersList + '\nأدخل رقم المستخدم:');
            if (userChoice && !isNaN(userChoice)) {
                const userIndex = parseInt(userChoice) - 1;
                if (userIndex >= 0 && userIndex < WebOSDB.users.length) {
                    const selectedUser = WebOSDB.users[userIndex];
                    document.getElementById('loginUsername').textContent = selectedUser.username;
                    document.getElementById('loginUserImage').src = selectedUser.avatar || 'https://i.pravatar.cc/150?img=12';
                }
            }
        }

        // بدء تشغيل النظام
        window.addEventListener('load', () => {
            WebOS.init();
        });
    </script>
</body>
</html>
